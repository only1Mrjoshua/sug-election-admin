<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - Obong University SRC Elections</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
          --primary-red: #D13D39;
          --primary-green: #2C8A45;
          --primary-yellow: #EBBF00;
          --dark-red: #b32b2b;
          --light-red: #f8e6e5;
          --light-green: #e8f5e9;
          --light-yellow: #fff9e6;
          --dark-gray: #333;
          --medium-gray: #666;
          --light-gray: #f5f5f5;
          --white: #ffffff;
          --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
          --radius: 12px;
          --transition: all 0.3s ease;
      }

      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
      }

      body {
          font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
          background: linear-gradient(135deg, #f9f9f9 0%, #f0f0f0 100%);
          min-height: 100vh;
          padding: 20px;
          color: var(--dark-gray);
          line-height: 1.6;
      }

      .container {
          max-width: 1400px;
          margin: 0 auto;
      }

      .header {
          display: flex;
          align-items: center;
          justify-content: space-between;
          background: var(--white);
          padding: 25px 30px;
          border-radius: var(--radius) var(--radius) 0 0;
          margin-bottom: 0;
          box-shadow: var(--shadow);
          border-bottom: 4px solid var(--primary-red);
      }

      .university-info h1 {
          color: var(--primary-red);
          font-size: 2.2rem;
          margin-bottom: 8px;
          font-weight: 800;
          letter-spacing: -0.5px;
      }

      .university-info .subtitle {
          color: var(--primary-green);
          font-size: 1.2rem;
          font-weight: 600;
      }

      .admin-section {
          display: flex;
          align-items: center;
          gap: 20px;
      }

      .election-status {
          background: {{ status_color }};
          color: var(--white);
          padding: 10px 20px;
          border-radius: 30px;
          font-weight: 600;
          font-size: 0.9rem;
          display: flex;
          align-items: center;
          gap: 8px;
          text-transform: uppercase;
      }

      .admin-badge {
          background: linear-gradient(135deg, var(--primary-red) 0%, var(--dark-red) 100%);
          color: var(--white);
          padding: 12px 24px;
          border-radius: 30px;
          font-weight: 600;
          font-size: 1rem;
          display: flex;
          align-items: center;
          gap: 8px;
          box-shadow: 0 4px 8px rgba(209, 61, 57, 0.3);
      }

      .logout-btn {
          background: transparent;
          border: 2px solid var(--primary-red);
          color: var(--primary-red);
          padding: 10px 20px;
          border-radius: 30px;
          font-weight: 600;
          cursor: pointer;
          transition: var(--transition);
          text-decoration: none;
          display: flex;
          align-items: center;
          gap: 8px;
      }

      .logout-btn:hover {
          background: var(--primary-red);
          color: var(--white);
      }

      /* Mobile Menu Styles */
      .mobile-menu-btn {
          display: none;
          background: transparent;
          border: none;
          font-size: 1.5rem;
          color: var(--primary-red);
          cursor: pointer;
          padding: 10px;
          border-radius: 8px;
          transition: var(--transition);
      }

      .mobile-menu-btn:hover {
          background: var(--light-red);
      }

      .mobile-overlay {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.5);
          z-index: 998;
      }

      .mobile-sidebar {
          display: none;
          position: fixed;
          top: 0;
          right: -300px;
          width: 280px;
          height: 100%;
          background: var(--white);
          box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
          z-index: 999;
          transition: var(--transition);
          padding: 20px;
          overflow-y: auto;
      }

      .mobile-sidebar.active {
          right: 0;
      }

      .mobile-sidebar-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 30px;
          padding-bottom: 15px;
          border-bottom: 2px solid var(--light-gray);
      }

      .mobile-sidebar-close {
          background: transparent;
          border: none;
          font-size: 1.5rem;
          color: var(--primary-red);
          cursor: pointer;
          padding: 5px;
          border-radius: 5px;
          transition: var(--transition);
      }

      .mobile-sidebar-close:hover {
          background: var(--light-red);
      }

      .main-content {
          display: grid;
          grid-template-columns: 280px 1fr;
          gap: 25px;
          margin-top: 25px;
      }

      .sidebar {
          background: var(--white);
          border-radius: var(--radius);
          padding: 25px;
          box-shadow: var(--shadow);
          height: fit-content;
          position: sticky;
          top: 25px;
      }

      .nav-item {
          display: flex;
          align-items: center;
          gap: 12px;
          padding: 16px 20px;
          margin-bottom: 10px;
          border-radius: 10px;
          cursor: pointer;
          transition: var(--transition);
          font-weight: 600;
          color: var(--medium-gray);
      }

      .nav-item:hover {
          background: var(--light-yellow);
          color: var(--dark-gray);
      }

      .nav-item.active {
          background: linear-gradient(135deg, var(--primary-red) 0%, var(--dark-red) 100%);
          color: var(--white);
          box-shadow: 0 4px 12px rgba(209, 61, 57, 0.3);
      }

      .content-area {
          background: var(--white);
          border-radius: var(--radius);
          padding: 30px;
          box-shadow: var(--shadow);
          min-height: 600px;
      }

      .tab-content {
          display: none;
      }

      .tab-content.active {
          display: block;
          animation: fadeIn 0.5s ease;
      }

      @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
      }

      .page-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 25px;
          padding-bottom: 15px;
          border-bottom: 2px solid var(--light-gray);
      }

      .page-title {
          color: var(--primary-red);
          font-size: 1.8rem;
          font-weight: 700;
      }

      .page-description {
          color: var(--medium-gray);
          font-size: 1.1rem;
          margin-bottom: 25px;
      }

      .stats-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
          gap: 20px;
          margin-bottom: 30px;
      }

      .stat-card {
          background: var(--white);
          border-radius: var(--radius);
          padding: 25px;
          box-shadow: var(--shadow);
          border-left: 5px solid var(--primary-red);
          transition: var(--transition);
      }

      .stat-card:hover {
          transform: translateY(-5px);
          box-shadow: 0 8px 16px rgba(0,0,0,0.1);
      }

      .stat-card.green {
          border-left-color: var(--primary-green);
      }

      .stat-card.yellow {
          border-left-color: var(--primary-yellow);
      }

      .stat-icon {
          font-size: 2.5rem;
          margin-bottom: 15px;
          color: var(--primary-red);
      }

      .stat-card.green .stat-icon {
          color: var(--primary-green);
      }

      .stat-card.yellow .stat-icon {
          color: var(--primary-yellow);
      }

      .stat-number {
          font-size: 2.8rem;
          font-weight: 800;
          margin-bottom: 5px;
          color: var(--dark-gray);
      }

      .stat-label {
          font-size: 1rem;
          color: var(--medium-gray);
          font-weight: 600;
      }

      .btn {
          background: linear-gradient(135deg, var(--primary-red) 0%, var(--dark-red) 100%);
          color: var(--white);
          border: none;
          padding: 14px 28px;
          border-radius: 8px;
          font-size: 16px;
          font-weight: 600;
          cursor: pointer;
          transition: var(--transition);
          display: inline-flex;
          align-items: center;
          gap: 8px;
          box-shadow: 0 4px 8px rgba(209, 61, 57, 0.3);
          text-decoration: none;
      }

      .btn:hover {
          transform: translateY(-2px);
          box-shadow: 0 6px 12px rgba(209, 61, 57, 0.4);
      }

      .btn-secondary {
          background: linear-gradient(135deg, var(--primary-green) 0%, #1e7e34 100%);
          box-shadow: 0 4px 8px rgba(44, 138, 69, 0.3);
      }

      .btn-secondary:hover {
          box-shadow: 0 6px 12px rgba(44, 138, 69, 0.4);
      }

      .btn-outline {
          background: transparent;
          border: 2px solid var(--primary-red);
          color: var(--primary-red);
          box-shadow: none;
      }

      .btn-outline:hover {
          background: var(--primary-red);
          color: var(--white);
      }

      .btn-warning {
          background: linear-gradient(135deg, var(--primary-yellow) 0%, #b38f00 100%);
          box-shadow: 0 4px 8px rgba(235, 191, 0, 0.3);
      }

      .results-grid {
          display: grid;
          gap: 25px;
          margin-top: 25px;
      }

      .position-card {
          background: var(--white);
          border-radius: var(--radius);
          padding: 25px;
          box-shadow: var(--shadow);
          border: 1px solid var(--light-gray);
          transition: var(--transition);
      }

      .position-card:hover {
          box-shadow: 0 6px 16px rgba(0,0,0,0.1);
      }

      .position-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 20px;
          padding-bottom: 15px;
          border-bottom: 2px solid var(--light-yellow);
      }

      .position-title {
          color: var(--primary-red);
          font-size: 1.5rem;
          font-weight: 700;
      }

      .position-votes {
          color: var(--medium-gray);
          font-weight: 600;
          background: var(--light-yellow);
          padding: 6px 12px;
          border-radius: 20px;
      }

      .candidates-list {
          display: grid;
          gap: 15px;
      }

      .candidate-card {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 18px;
          border-radius: 10px;
          background: var(--light-gray);
          transition: var(--transition);
      }

      .candidate-card.winner {
          background: linear-gradient(135deg, var(--primary-green) 0%, #4CAF50 100%);
          color: var(--white);
          box-shadow: 0 4px 12px rgba(44, 138, 69, 0.3);
      }

      .candidate-card:hover {
          transform: translateX(5px);
      }

      .candidate-info {
          flex: 1;
      }

      .candidate-name {
          font-weight: 700;
          font-size: 1.2rem;
          margin-bottom: 5px;
      }

      .candidate-department {
          font-size: 0.9rem;
          opacity: 0.8;
      }

      .candidate-stats {
          display: flex;
          align-items: center;
          gap: 15px;
      }

      .vote-count {
          font-weight: 700;
          font-size: 1.4rem;
      }

      .vote-percentage {
          background: rgba(255, 255, 255, 0.2);
          padding: 6px 12px;
          border-radius: 20px;
          font-weight: 600;
          font-size: 0.9rem;
      }

      .winner-badge {
          background: var(--primary-yellow);
          color: var(--dark-gray);
          padding: 6px 12px;
          border-radius: 20px;
          font-weight: 700;
          font-size: 0.9rem;
          display: flex;
          align-items: center;
          gap: 5px;
      }

      .voters-container {
          max-height: 500px;
          overflow-y: auto;
          margin-top: 20px;
          border-radius: var(--radius);
          border: 1px solid var(--light-gray);
      }

      .voter-card {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 18px 25px;
          border-bottom: 1px solid var(--light-gray);
          transition: var(--transition);
      }

      .voter-card:hover {
          background: var(--light-yellow);
      }

      .voter-info {
          flex: 1;
      }

      .voter-name {
          font-weight: 700;
          margin-bottom: 5px;
      }

      .voter-details {
          font-size: 0.9rem;
          color: var(--medium-gray);
      }

      .voter-status {
          padding: 8px 16px;
          border-radius: 20px;
          font-size: 0.85rem;
          font-weight: 600;
      }

      .status-verified {
          background: var(--light-green);
          color: var(--primary-green);
      }

      .status-pending {
          background: var(--light-yellow);
          color: #b38f00;
      }

      .alert {
          padding: 18px 25px;
          border-radius: var(--radius);
          margin-bottom: 25px;
          display: flex;
          align-items: center;
          gap: 15px;
      }

      .alert-success {
          background: var(--light-green);
          border-left: 5px solid var(--primary-green);
          color: var(--primary-green);
      }

      .alert-error {
          background: var(--light-red);
          border-left: 5px solid var(--primary-red);
          color: var(--primary-red);
      }

      .alert-warning {
          background: var(--light-yellow);
          border-left: 5px solid var(--primary-yellow);
          color: #b38f00;
      }

      .system-status {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 20px;
          margin-top: 30px;
      }

      .status-card {
          background: var(--white);
          border-radius: var(--radius);
          padding: 20px;
          box-shadow: var(--shadow);
          text-align: center;
          border-top: 4px solid var(--primary-green);
      }

      .status-card.offline {
          border-top-color: var(--primary-red);
      }

      .status-icon {
          font-size: 2.5rem;
          margin-bottom: 15px;
      }

      .status-card.online .status-icon {
          color: var(--primary-green);
      }

      .status-card.offline .status-icon {
          color: var(--primary-red);
      }

      .status-title {
          font-weight: 700;
          margin-bottom: 10px;
      }

      .status-description {
          font-size: 0.9rem;
          color: var(--medium-gray);
      }

      .last-update {
          text-align: center;
          margin-top: 25px;
          color: var(--medium-gray);
          font-size: 0.9rem;
      }

      .footer {
          text-align: center;
          color: var(--medium-gray);
          margin-top: 40px;
          padding: 25px;
          font-size: 0.9rem;
      }

      .loading {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 60px 20px;
          color: var(--medium-gray);
      }

      .loading-spinner {
          width: 50px;
          height: 50px;
          border: 5px solid var(--light-gray);
          border-top: 5px solid var(--primary-red);
          border-radius: 50%;
          animation: spin 1s linear infinite;
          margin-bottom: 20px;
      }

      @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
      }

      .empty-state {
          text-align: center;
          padding: 60px 20px;
          color: var(--medium-gray);
      }

      .empty-icon {
          font-size: 4rem;
          margin-bottom: 20px;
          opacity: 0.5;
      }

      /* Mobile Responsive Design */
      @media (max-width: 1024px) {
          .main-content {
              grid-template-columns: 1fr;
          }

          .sidebar {
              display: none;
          }

          .mobile-menu-btn {
              display: block;
          }

          .mobile-sidebar {
              display: block;
          }

          .mobile-overlay {
              display: block;
          }

          .header {
              padding: 20px;
          }

          .admin-section {
              gap: 15px;
          }

          .election-status {
              padding: 8px 16px;
              font-size: 0.8rem;
          }

          .admin-badge {
              padding: 10px 18px;
              font-size: 0.9rem;
          }

          .logout-btn {
              padding: 8px 16px;
              font-size: 0.9rem;
          }
      }

      @media (max-width: 768px) {
          body {
              padding: 10px;
          }

          .header {
              flex-direction: column;
              text-align: center;
              gap: 20px;
              padding: 20px 15px;
          }

          .admin-section {
              flex-direction: column;
              gap: 15px;
              width: 100%;
          }

          .election-status, .admin-badge, .logout-btn {
              width: 100%;
              justify-content: center;
          }

          .content-area {
              padding: 20px;
              border-radius: 10px;
          }

          .page-header {
              flex-direction: column;
              align-items: flex-start;
              gap: 15px;
          }

          .page-title {
              font-size: 1.5rem;
          }

          .stats-grid {
              grid-template-columns: 1fr;
              gap: 15px;
          }

          .stat-card {
              padding: 20px;
          }

          .stat-number {
              font-size: 2.2rem;
          }

          .candidate-card {
              flex-direction: column;
              align-items: flex-start;
              gap: 15px;
          }

          .candidate-stats {
              width: 100%;
              justify-content: space-between;
          }

          .voter-card {
              flex-direction: column;
              align-items: flex-start;
              gap: 15px;
          }

          .system-status {
              grid-template-columns: 1fr;
          }

          .position-card {
              padding: 20px;
          }

          .position-header {
              flex-direction: column;
              align-items: flex-start;
              gap: 10px;
          }

          .position-title {
              font-size: 1.3rem;
          }
      }

      @media (max-width: 480px) {
          .container {
              padding: 0;
          }

          .header {
              border-radius: 0;
              margin-bottom: 0;
          }

          .content-area {
              border-radius: 0;
              padding: 15px;
          }

          .university-info h1 {
              font-size: 1.8rem;
          }

          .page-title {
              font-size: 1.3rem;
          }

          .btn {
              padding: 12px 20px;
              font-size: 14px;
              width: 100%;
              justify-content: center;
          }

          .page-header {
              flex-direction: column;
              gap: 15px;
          }

          .mobile-sidebar {
              width: 100%;
              right: -100%;
          }

          .mobile-sidebar.active {
              right: 0;
          }

          .nav-item {
              padding: 20px;
              font-size: 1.1rem;
          }

          .alert {
              padding: 15px;
              flex-direction: column;
              text-align: center;
              gap: 10px;
          }

          .voter-card {
              padding: 15px;
          }

          .voter-details {
              font-size: 0.8rem;
          }

          .candidate-card {
              padding: 15px;
          }

          .candidate-name {
              font-size: 1.1rem;
          }
      }

      @media (max-width: 360px) {
          .university-info h1 {
              font-size: 1.5rem;
          }

          .university-info .subtitle {
              font-size: 1rem;
          }

          .content-area {
              padding: 10px;
          }

          .stat-card {
              padding: 15px;
          }

          .stat-number {
              font-size: 1.8rem;
          }

          .position-card {
              padding: 15px;
          }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div class="university-info">
          <h1>OBONG UNIVERSITY</h1>
          <div class="subtitle">Admin Dashboard - SRC Elections 2025</div>
        </div>
        <div class="admin-section">
          <div class="election-status">
            <i class="fas fa-circle"></i>
            {{ election_status.replace('_', ' ').title() }}
          </div>
          <div class="admin-badge">
            <i class="fas fa-shield-alt"></i>
            ADMIN ACCESS
          </div>
          <a href="/admin/logout" class="logout-btn">
            <i class="fas fa-sign-out-alt"></i>
            Logout
          </a>
          <button class="mobile-menu-btn" id="mobileMenuBtn">
            <i class="fas fa-bars"></i>
          </button>
        </div>
      </div>

      <!-- Mobile Overlay -->
      <div class="mobile-overlay" id="mobileOverlay"></div>

      <!-- Mobile Sidebar -->
      <div class="mobile-sidebar" id="mobileSidebar">
        <div class="mobile-sidebar-header">
          <h3>Navigation Menu</h3>
          <button class="mobile-sidebar-close" id="mobileSidebarClose">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="nav-items">
          <div class="nav-item active" data-tab="results">
            <i class="fas fa-chart-bar"></i>
            Live Results
          </div>
          <div class="nav-item" data-tab="dashboard">
            <i class="fas fa-tachometer-alt"></i>
            Election Dashboard
          </div>
          <div class="nav-item" data-tab="voters">
            <i class="fas fa-users"></i>
            Registered Voters
          </div>
          <div class="nav-item" data-tab="settings">
            <i class="fas fa-cog"></i>
            System Settings
          </div>
        </div>
      </div>

      <div class="main-content">
        <!-- Desktop Sidebar -->
        <div class="sidebar">
          <div class="nav-items">
            <div class="nav-item active" data-tab="results">
              <i class="fas fa-chart-bar"></i>
              Live Results
            </div>
            <div class="nav-item" data-tab="dashboard">
              <i class="fas fa-tachometer-alt"></i>
              Election Dashboard
            </div>
            <div class="nav-item" data-tab="voters">
              <i class="fas fa-users"></i>
              Registered Voters
            </div>
            <div class="nav-item" data-tab="settings">
              <i class="fas fa-cog"></i>
              System Settings
            </div>
          </div>
        </div>

        <div class="content-area">
          <!-- Results Tab -->
          <div id="results-tab" class="tab-content active">
            <div class="page-header">
              <div>
                <h2 class="page-title">Live Election Results</h2>
                <p class="page-description">
                  Real-time election results as votes are being cast and
                  counted.
                </p>
              </div>
              <button class="btn" id="refresh-results">
                <i class="fas fa-sync-alt"></i>
                Refresh Results
              </button>
            </div>

            <div id="results-container">
              <div class="loading">
                <div class="loading-spinner"></div>
                <h3>Loading Election Results</h3>
                <p>Please wait while we fetch the latest data...</p>
              </div>
            </div>
          </div>

          <!-- Dashboard Tab -->
          <div id="dashboard-tab" class="tab-content">
            <div class="page-header">
              <div>
                <h2 class="page-title">Election Dashboard</h2>
                <p class="page-description">
                  Overview of election statistics and system status.
                </p>
              </div>
              <button class="btn" id="refresh-stats">
                <i class="fas fa-sync-alt"></i>
                Refresh Stats
              </button>
            </div>

            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-users"></i>
                </div>
                <div class="stat-number" id="total-voters">0</div>
                <div class="stat-label">Registered Voters</div>
              </div>
              <div class="stat-card green">
                <div class="stat-icon">
                  <i class="fas fa-vote-yea"></i>
                </div>
                <div class="stat-number" id="total-votes">0</div>
                <div class="stat-label">Votes Cast</div>
              </div>
              <div class="stat-card yellow">
                <div class="stat-icon">
                  <i class="fas fa-chart-line"></i>
                </div>
                <div class="stat-number" id="turnout-rate">0%</div>
                <div class="stat-label">Voter Turnout</div>
              </div>
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-number" id="verified-voters">0</div>
                <div class="stat-label">Verified Voters</div>
              </div>
            </div>

            <div class="system-status">
              <div class="status-card online">
                <div class="status-icon">
                  <i class="fas fa-server"></i>
                </div>
                <div class="status-title">Server Status</div>
                <div class="status-description">All systems operational</div>
              </div>
              <div class="status-card online">
                <div class="status-icon">
                  <i class="fas fa-database"></i>
                </div>
                <div class="status-title">Database</div>
                <div class="status-description">Connected and responsive</div>
              </div>
              <div class="status-card online">
                <div class="status-icon">
                  <i class="fas fa-shield-alt"></i>
                </div>
                <div class="status-title">Security</div>
                <div class="status-description">All checks passed</div>
              </div>
            </div>

            <div class="last-update">
              <i class="fas fa-clock"></i>
              Last updated: <span id="last-update">Just now</span>
            </div>
          </div>

          <!-- Voters Tab -->
          <div id="voters-tab" class="tab-content">
            <div class="page-header">
              <div>
                <h2 class="page-title">Registered Voters</h2>
                <p class="page-description">
                  List of all registered voters and their verification status.
                </p>
              </div>
              <button class="btn" id="refresh-voters">
                <i class="fas fa-sync-alt"></i>
                Refresh Voters
              </button>
            </div>

            <div id="voters-container">
              <div class="loading">
                <div class="loading-spinner"></div>
                <h3>Loading Voter Information</h3>
                <p>Please wait while we fetch the latest data...</p>
              </div>
            </div>
          </div>

          <!-- Settings Tab -->
          <div id="settings-tab" class="tab-content">
            <div class="page-header">
              <h2 class="page-title">System Settings</h2>
              <p class="page-description">
                Manage election settings and system configuration.
              </p>
            </div>

            <div class="alert alert-warning">
              <i class="fas fa-exclamation-triangle"></i>
              <div>
                <strong>Administrator Access Required</strong>
                <p>Some settings require elevated permissions to modify.</p>
              </div>
            </div>

            <div class="position-card">
              <h3 class="position-title">Election Controls</h3>
              <div class="candidates-list">
                <div class="candidate-card">
                  <div class="candidate-info">
                    <div class="candidate-name">Start Election</div>
                    <div class="candidate-department">
                      Begin accepting votes from registered voters
                    </div>
                  </div>
                  <button
                    class="btn btn-secondary"
                    onclick="controlElection('start')"
                  >
                    <i class="fas fa-play"></i>
                    Start
                  </button>
                </div>
                <div class="candidate-card">
                  <div class="candidate-info">
                    <div class="candidate-name">Pause Election</div>
                    <div class="candidate-department">
                      Temporarily stop accepting votes
                    </div>
                  </div>
                  <button
                    class="btn btn-warning"
                    onclick="controlElection('pause')"
                  >
                    <i class="fas fa-pause"></i>
                    Pause
                  </button>
                </div>
                <div class="candidate-card">
                  <div class="candidate-info">
                    <div class="candidate-name">End Election</div>
                    <div class="candidate-department">
                      Stop accepting votes and calculate final results
                    </div>
                  </div>
                  <button
                    class="btn btn-outline"
                    onclick="controlElection('end')"
                  >
                    <i class="fas fa-stop"></i>
                    End
                  </button>
                </div>
                <div class="candidate-card">
                  <div class="candidate-info">
                    <div class="candidate-name">Reset Election</div>
                    <div class="candidate-department">
                      Reset all votes and start fresh (Dangerous!)
                    </div>
                  </div>
                  <button
                    class="btn btn-outline"
                    style="
                      border-color: var(--primary-red);
                      color: var(--primary-red);
                    "
                    onclick="controlElection('reset')"
                  >
                    <i class="fas fa-undo"></i>
                    Reset
                  </button>
                </div>
              </div>
            </div>

            <div class="position-card" style="margin-top: 25px">
              <h3 class="position-title">System Configuration</h3>
              <div class="candidates-list">
                <div class="candidate-card">
                  <div class="candidate-info">
                    <div class="candidate-name">Export Election Data</div>
                    <div class="candidate-department">
                      Download complete election results and logs
                    </div>
                  </div>
                  <button class="btn" onclick="exportData()">
                    <i class="fas fa-download"></i>
                    Export
                  </button>
                </div>
                <div class="candidate-card">
                  <div class="candidate-info">
                    <div class="candidate-name">System Logs</div>
                    <div class="candidate-department">
                      View system activity and error logs
                    </div>
                  </div>
                  <button class="btn">
                    <i class="fas fa-file-alt"></i>
                    View Logs
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="footer">
        <p>
          Obong University SRC Election System &copy; 2025 | Secure Admin
          Dashboard
        </p>
        <p>For technical support, contact ICT Department</p>
      </div>
    </div>

    <script>
      const API_BASE = "/api";

      // Mobile Menu Functionality
      const mobileMenuBtn = document.getElementById("mobileMenuBtn");
      const mobileSidebar = document.getElementById("mobileSidebar");
      const mobileSidebarClose = document.getElementById("mobileSidebarClose");
      const mobileOverlay = document.getElementById("mobileOverlay");

      function openMobileMenu() {
        mobileSidebar.classList.add("active");
        mobileOverlay.style.display = "block";
        document.body.style.overflow = "hidden";
      }

      function closeMobileMenu() {
        mobileSidebar.classList.remove("active");
        mobileOverlay.style.display = "none";
        document.body.style.overflow = "auto";
      }

      mobileMenuBtn.addEventListener("click", openMobileMenu);
      mobileSidebarClose.addEventListener("click", closeMobileMenu);
      mobileOverlay.addEventListener("click", closeMobileMenu);

      // Close mobile menu when clicking on nav items
      document.querySelectorAll(".mobile-sidebar .nav-item").forEach((item) => {
        item.addEventListener("click", () => {
          closeMobileMenu();
          // Also trigger the tab change
          const tab = item.getAttribute("data-tab");
          switchTab(tab);
        });
      });

      // Tab navigation function
      function switchTab(tabName) {
        // Remove active class from all items
        document.querySelectorAll(".nav-item").forEach((nav) => {
          nav.classList.remove("active");
        });

        // Add active class to clicked item
        document
          .querySelectorAll(`.nav-item[data-tab="${tabName}"]`)
          .forEach((nav) => {
            nav.classList.add("active");
          });

        // Hide all tab content
        document.querySelectorAll(".tab-content").forEach((tab) => {
          tab.classList.remove("active");
        });

        // Show selected tab content
        const tabId = tabName + "-tab";
        document.getElementById(tabId).classList.add("active");

        // Load data for specific tabs
        if (tabName === "results") {
          loadResults();
        } else if (tabName === "dashboard") {
          loadStats();
        } else if (tabName === "voters") {
          loadVoters();
        }
      }

      // Tab navigation for desktop
      document.querySelectorAll(".sidebar .nav-item").forEach((item) => {
        item.addEventListener("click", function () {
          const tabName = this.getAttribute("data-tab");
          switchTab(tabName);
        });
      });

      // Button event listeners
      document
        .getElementById("refresh-results")
        .addEventListener("click", loadResults);
      document
        .getElementById("refresh-stats")
        .addEventListener("click", loadStats);
      document
        .getElementById("refresh-voters")
        .addEventListener("click", loadVoters);

      // Error handling function
      function handleError(context, error) {
        console.error(`Error in ${context}:`, error);

        let errorMessage = "An unexpected error occurred. Please try again.";
        if (error.message) {
          errorMessage = error.message;
        }

        // Create error alert
        const alert = document.createElement("div");
        alert.className = "alert alert-error";
        alert.innerHTML = `
                <i class="fas fa-exclamation-circle"></i>
                <div>
                    <strong>Error in ${context}</strong>
                    <p>${errorMessage}</p>
                </div>
            `;

        // Insert at the top of the current tab content
        const currentTab = document.querySelector(".tab-content.active");
        currentTab.insertBefore(alert, currentTab.firstChild);

        // Remove alert after 5 seconds
        setTimeout(() => {
          alert.remove();
        }, 5000);
      }

      // Load results
      async function loadResults() {
        const container = document.getElementById("results-container");

        try {
          // Show loading state
          container.innerHTML = `
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <h3>Loading Election Results</h3>
                        <p>Please wait while we fetch the latest data...</p>
                    </div>
                `;

          const response = await fetch(API_BASE + "/results");

          if (!response.ok) {
            throw new Error(
              `Server returned ${response.status}: ${response.statusText}`
            );
          }

          const result = await response.json();

          if (result.success) {
            container.innerHTML = "";

            if (result.results && result.results.length > 0) {
              // Group by position
              const positions = {};
              result.results.forEach((candidate) => {
                if (!positions[candidate.position]) {
                  positions[candidate.position] = [];
                }
                positions[candidate.position].push(candidate);
              });

              // Find winners and create results
              for (const [position, candidates] of Object.entries(positions)) {
                const positionCard = document.createElement("div");
                positionCard.className = "position-card";

                // Calculate total votes for this position
                const totalVotes = candidates.reduce(
                  (sum, candidate) => sum + candidate.votes,
                  0
                );

                // Find winner (most votes)
                const winner = candidates.reduce((prev, current) =>
                  prev.votes > current.votes ? prev : current
                );

                let positionHTML = `
                                <div class="position-header">
                                    <div class="position-title">${position}</div>
                                    <div class="position-votes">${totalVotes} Total Votes</div>
                                </div>
                                <div class="candidates-list">
                            `;

                candidates
                  .sort((a, b) => b.votes - a.votes)
                  .forEach((candidate) => {
                    const isWinner =
                      candidate.votes === winner.votes && candidate.votes > 0;
                    const percentage =
                      totalVotes > 0
                        ? Math.round((candidate.votes / totalVotes) * 100)
                        : 0;

                    positionHTML += `
                                    <div class="candidate-card ${
                                      isWinner ? "winner" : ""
                                    }">
                                        <div class="candidate-info">
                                            <div class="candidate-name">${
                                              candidate.name
                                            }</div>
                                            <div class="candidate-department">${
                                              candidate.department ||
                                              "No department specified"
                                            }</div>
                                        </div>
                                        <div class="candidate-stats">
                                            <div class="vote-count">${
                                              candidate.votes
                                            }</div>
                                            <div class="vote-percentage">${percentage}%</div>
                                            ${
                                              isWinner
                                                ? '<div class="winner-badge"><i class="fas fa-trophy"></i> LEADING</div>'
                                                : ""
                                            }
                                        </div>
                                    </div>
                                `;
                  });

                positionHTML += `</div>`;
                positionCard.innerHTML = positionHTML;
                container.appendChild(positionCard);
              }

              // Show success message
              const alert = document.createElement("div");
              alert.className = "alert alert-success";
              alert.innerHTML = `
                            <i class="fas fa-check-circle"></i>
                            <div>
                                <strong>Results Updated</strong>
                                <p>Election results have been successfully refreshed.</p>
                            </div>
                        `;
              container.insertBefore(alert, container.firstChild);

              // Remove alert after 3 seconds
              setTimeout(() => {
                alert.remove();
              }, 3000);
            } else {
              container.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-icon">
                                    <i class="fas fa-chart-bar"></i>
                                </div>
                                <h3>No Results Available</h3>
                                <p>Election results will appear here once voting begins.</p>
                            </div>
                        `;
            }

            document.getElementById("last-update").textContent =
              new Date().toLocaleString();
          } else {
            throw new Error(result.message || "Failed to load results");
          }
        } catch (error) {
          handleError("loadResults", error);

          // Show error state
          container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <h3>Unable to Load Results</h3>
                        <p>There was a problem fetching the election results. Please try again.</p>
                        <button class="btn" style="margin-top: 20px;" onclick="loadResults()">
                            <i class="fas fa-redo"></i>
                            Try Again
                        </button>
                    </div>
                `;
        }
      }

      // Load statistics
      async function loadStats() {
        try {
          const response = await fetch(API_BASE + "/stats");

          if (!response.ok) {
            throw new Error(
              `Server returned ${response.status}: ${response.statusText}`
            );
          }

          const result = await response.json();

          if (result.success) {
            document.getElementById("total-voters").textContent =
              result.stats.total_registered_voters;
            document.getElementById("total-votes").textContent =
              result.stats.votes_cast;

            // Calculate turnout percentage
            const turnout =
              result.stats.total_registered_voters > 0
                ? Math.round(
                    (result.stats.votes_cast /
                      result.stats.total_registered_voters) *
                      100
                  )
                : 0;
            document.getElementById("turnout-rate").textContent = turnout + "%";

            document.getElementById("verified-voters").textContent =
              result.stats.verified_voters ||
              result.stats.total_registered_voters;
            document.getElementById("last-update").textContent =
              new Date().toLocaleString();

            // Show success message
            const currentTab = document.getElementById("dashboard-tab");
            const alert = document.createElement("div");
            alert.className = "alert alert-success";
            alert.innerHTML = `
                        <i class="fas fa-check-circle"></i>
                        <div>
                            <strong>Statistics Updated</strong>
                            <p>Election statistics have been successfully refreshed.</p>
                        </div>
                    `;
            currentTab.insertBefore(
              alert,
              currentTab.querySelector(".stats-grid")
            );

            // Remove alert after 3 seconds
            setTimeout(() => {
              alert.remove();
            }, 3000);
          } else {
            throw new Error(result.message || "Failed to load statistics");
          }
        } catch (error) {
          handleError("loadStats", error);
        }
      }

      // Load voters list
      async function loadVoters() {
        const container = document.getElementById("voters-container");

        try {
          // Show loading state
          container.innerHTML = `
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <h3>Loading Voter Information</h3>
                        <p>Please wait while we fetch the latest data...</p>
                    </div>
                `;

          const response = await fetch(API_BASE + "/voters");

          if (!response.ok) {
            throw new Error(
              `Server returned ${response.status}: ${response.statusText}`
            );
          }

          const result = await response.json();

          if (result.success) {
            container.innerHTML = "";

            if (result.voters.length === 0) {
              container.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <h3>No Voters Registered</h3>
                                <p>Voter registration data will appear here once voters are registered.</p>
                            </div>
                        `;
              return;
            }

            const votersList = document.createElement("div");
            votersList.className = "voters-container";

            result.voters.forEach((voter) => {
              const voterCard = document.createElement("div");
              voterCard.className = "voter-card";
              voterCard.innerHTML = `
                            <div class="voter-info">
                                <div class="voter-name">${voter.name}</div>
                                <div class="voter-details">
                                    Matric: ${voter.matric_number} | Email: ${
                voter.email
              } | Faculty: ${voter.faculty || "Not specified"}
                                </div>
                            </div>
                            <div class="voter-status ${
                              voter.location_verified
                                ? "status-verified"
                                : "status-pending"
                            }">
                                ${
                                  voter.location_verified
                                    ? '<i class="fas fa-check-circle"></i> Verified'
                                    : '<i class="fas fa-clock"></i> Pending'
                                }
                            </div>
                        `;
              votersList.appendChild(voterCard);
            });

            container.appendChild(votersList);

            // Show success message
            const alert = document.createElement("div");
            alert.className = "alert alert-success";
            alert.innerHTML = `
                        <i class="fas fa-check-circle"></i>
                        <div>
                            <strong>Voter List Updated</strong>
                            <p>Voter information has been successfully refreshed.</p>
                        </div>
                    `;
            container.insertBefore(alert, container.firstChild);

            // Remove alert after 3 seconds
            setTimeout(() => {
              alert.remove();
            }, 3000);
          } else {
            throw new Error(result.message || "Failed to load voters");
          }
        } catch (error) {
          handleError("loadVoters", error);

          // Show error state
          container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <h3>Unable to Load Voters</h3>
                        <p>There was a problem fetching the voter list. Please try again.</p>
                        <button class="btn" style="margin-top: 20px;" onclick="loadVoters()">
                            <i class="fas fa-redo"></i>
                            Try Again
                        </button>
                    </div>
                `;
        }
      }

      // Control election status
      async function controlElection(action) {
        try {
          const response = await fetch(API_BASE + "/election/control", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ action: action }),
          });

          const result = await response.json();

          if (result.success) {
            // Show success message
            const alert = document.createElement("div");
            alert.className = "alert alert-success";
            alert.innerHTML = `
                        <i class="fas fa-check-circle"></i>
                        <div>
                            <strong>Election ${
                              action.charAt(0).toUpperCase() + action.slice(1)
                            }ed</strong>
                            <p>${result.message}</p>
                        </div>
                    `;

            const currentTab = document.querySelector(".tab-content.active");
            currentTab.insertBefore(alert, currentTab.firstChild);

            // Remove alert after 5 seconds
            setTimeout(() => {
              alert.remove();
            }, 5000);

            // Reload page to update status
            setTimeout(() => {
              window.location.reload();
            }, 2000);
          } else {
            throw new Error(result.message || "Failed to control election");
          }
        } catch (error) {
          handleError("controlElection", error);
        }
      }

      // Export data
      async function exportData() {
        try {
          const response = await fetch(API_BASE + "/export");
          const blob = await response.blob();
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.style.display = "none";
          a.href = url;
          a.download =
            "election-data-" + new Date().toISOString().split("T")[0] + ".json";
          document.body.appendChild(a);
          a.click();
          window.URL.revokeObjectURL(url);

          // Show success message
          const alert = document.createElement("div");
          alert.className = "alert alert-success";
          alert.innerHTML = `
                    <i class="fas fa-check-circle"></i>
                    <div>
                        <strong>Export Successful</strong>
                        <p>Election data has been downloaded.</p>
                    </div>
                `;

          const currentTab = document.querySelector(".tab-content.active");
          currentTab.insertBefore(alert, currentTab.firstChild);

          // Remove alert after 5 seconds
          setTimeout(() => {
            alert.remove();
          }, 5000);
        } catch (error) {
          handleError("exportData", error);
        }
      }

      // Initialize the page
      document.addEventListener("DOMContentLoaded", () => {
        loadResults();
        loadStats();

        // Auto-refresh results every 30 seconds if on results tab
        setInterval(() => {
          if (
            document
              .querySelector(".nav-item.active")
              .getAttribute("data-tab") === "results"
          ) {
            loadResults();
          }
        }, 30000);
      });
    </script>
  </body>
</html>
